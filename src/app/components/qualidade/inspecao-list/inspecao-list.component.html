<div class="card-titulo container">
  <h1 class="Titulo">Inspeções</h1>
</div>
<app-loading *ngIf="!loading"></app-loading>

<div class="row filtros container" *ngIf="loading">
  <div class="col-md-4">
    <div class="form-group">
      <label>Status</label>
      <select
        [(ngModel)]="filtroStatus"
        (change)="filtrarStatus()"
        class="form-control select2"
        style="width: 100%; border-radius: 5px;"
      >
        <option *ngFor="let item of filtros.status" [value]="item.id">{{
          item.nome
        }}</option>
      </select>
    </div>
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label>Inspetor</label>
      <select
        [(ngModel)]="filtroInspetor"
        (change)="filtrarInspetor()"
        class="form-control select2"
        style="width: 100%; border-radius: 5px;"
      >
        <option *ngFor="let item of filtros.inspetor" [value]="item.nome">{{
          item.nome
        }}</option>
      </select>
    </div>
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label>Cliente</label>
      <select
        [(ngModel)]="filtrocliente"
        (change)="filtrarCliente()"
        class="form-control select2"
        style="width: 100%; border-radius: 5px;"
      >
        <option *ngFor="let item of filtros.clientes" [value]="item.nome">{{
          item.nome
        }}</option>
      </select>
    </div>
  </div>
</div>
<section *ngIf="loading" class="container">
  <div class="box box-default">
    <div class="box-header with-border">
      <button hidden
        #openBtn
        data-toggle="modal"
        data-target="#inspecaoModal"
      >
        
      </button>

      <button
        type="button"
        class="btn btn-success btn-novo"
        data-toggle="modal"
        data-target="#inspecaoModal"
      >
        Nova inspeção
      </button>

      <div class="box-tools pull-right">
        <div class="has-feedback">
          <input
            type="text"
            class="form-control input-sm"
            placeholder="Procurar..."
            style="border-radius: 5px;"
            [(ngModel)]="filtroAll"
            (change)="listInspecaoFiltroString()"
          />
          <span class="glyphicon glyphicon-search form-control-feedback"></span>
        </div>
      </div>
    </div>
    <div
      *ngFor="let item of inspecoes"
      [ngStyle]="setStyle(item.statusInspecao)"
      class="container box-body inspecoes"
    >
      <div class="card">
        <div class="row">
          <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10">
            <a (click)="fazerInspecao(item.id)" href="javascript:void(0)">
              <strong
                ><p>{{ item.equipamento.descricao }}</p></strong
              >
            </a>
          </div>
          <div class="col-12 col-sm-12 col-md-2 col-lg-2 col-xl-2">
            <button type="button" (click)="buscarInspecao(item.id)" class="btn btn-primary">Editar</button>
          </div>
        </div>

        <hr />
        <div class="row">
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p><strong>PN: </strong> {{ item.equipamento.partNumber }}</p>
          </div>
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p>
              <strong>Nota Fiscal: </strong>
              {{ item.notaFiscal.numeroNotaFiscal }}
            </p>
          </div>
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p>
              <strong>Data Inspeção: </strong>
              {{ item.dataInspecao | date: "dd/MM/yyyy" }}
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p><strong>NS: </strong> {{ item.equipamento.serialNumber }}</p>
          </div>
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p>
              <strong>Cliente: </strong> {{ item.equipamento.cliente.nome }}
            </p>
          </div>
          <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
            <p>
              <strong>Relatório: </strong>
              {{ item.ordemServico.numeroRelatorio }}
            </p>
          </div>
        </div>
        <div class="box-footer clearfix">
          <div class="row">
            <p
              class="inspecionado col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10"
            >
              <strong>Inspecionado Por: </strong> {{ item.usuario?.nome }}
            </p>
            <div class="col-12 col-sm-12 col-md-2 col-lg-2 col-xl-2">
              <span
                [ngStyle]="setStyleBtn(item.statusInspecao)"
                type="button"
                class="badge"
              >
                {{ item.statusInspecao }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="box-footer clearfix">
      <ul class="pagination pagination-sm no-margin pull-right">
        <li>
          <a href="javascript:void(0)" (click)="paginar('anterior')">&laquo;</a>
        </li>
        <li *ngFor="let item of [].constructor(totalPages); let i = index">
          <a href="javascript:void(0)" (click)="paginar(i)">{{ i + 1 }}</a>
        </li>
        <li *ngIf="totalPages > 4"><a>...</a></li>
        <li>
          <a href="javascript:void(0)" (click)="paginar('proximo')">&raquo;</a>
        </li>
      </ul>
    </div>
  </div>
</section>

<!-- <app-loading *ngIf="!loading"></app-loading>

<section *ngIf="loading"  class="content">
  <div class="box box-primary">
    <div class="box-header with-border">
      <button
        type="button"
        
        class="btn btn-success"
        data-toggle="modal" data-target="#inspecaoModal"
      >
        Nova inspeção</button
      ><br /><br />
      <h3 class="box-title">Inspeção de Recebimento</h3>

      <div class="box-tools pull-right">
        <div class="has-feedback">
          <input
            type="text"
            class="form-control input-sm"
            placeholder="Procurar ordem"
          />
          <span class="glyphicon glyphicon-search form-control-feedback"></span>
        </div>
      </div>

      <div class="col-md-12" *ngFor="let item of inspecoes">
        <a (click)="fazerInspecao(item.id)" href="javascript:void(0)">        
        <div class="box box-solid">
          <div class="box-header with-border">
            <i class="fa fa-text-width"></i>

            <h3 class="box-title">{{item.notaFiscal.numeroNotaFiscal}}</h3>
          </div>
          <div class="box-body">
            <blockquote [class]="getColor(item.statusInspecao)">
              <p>
                {{item.equipamento.descricao}}, {{item.equipamento.partNumber}}, {{item.equipamento.serialNumber}}
              </p>
              <small>
                {{item.statusInspecao}}
              </small>
            </blockquote>
          </div>
        </div>
      </a>
      </div>
    </div>
  </div>
</section>
-->
<!---------------------------------Modal----------------------------------------------->

<div id="inspecaoModal" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          #closeBtn
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Criar Inspeção</h4>
      </div>
      <div class="modal-body">
        <div class="box-body">
          <div class="input-group input-group-sm col-md-6">
            <label>Nota Fiscal</label>
            <input
              type="text"
              class="form-control"
              placeholder=""
              value="1254"
              [(ngModel)]="numeroNotaFiscal"
            />
            <span class="input-group-btn" style="padding-top: 23px;">
              <button
                type="button"
                data-toggle="modal"
                data-target="#equipamentoModal"
                class="btn btn-success btn-pesquisar btn-flat"
                (click)="pesquisarPorNota()"
              >
                Pesquisar Nota Fiscal
              </button>
            </span>
          </div>
          <br />
          <form role="form">
            <!-- text input -->
            <div class="row">
              <div class="form-group col-md-6">
                <label>Nº Ordem Serviço</label>
                <input
                  type="text"
                  [(ngModel)]="inspecao.ordemServico.numeroOrdem"
                  #nome="ngModel"
                  name="numeroOrdem"
                  id="numeroOrdem"
                  class="form-control"
                  placeholder="31254525"
                />
              </div>
              <div class="form-group col-md-6">
                <label>Tempo Inspeção</label>
                <input
                  type="number"
                  [(ngModel)]="inspecao.ordemServico.tempoServico"
                  #nome="ngModel"
                  name="tempoServico"
                  id="tempoServico"
                  class="form-control"
                  placeholder="1,5"
                />
              </div>
            </div>
            <div class="row">
              <div class="form-group col-md-12">
                <label>Nº Relatório</label>
                <input
                  type="text"
                  [(ngModel)]="inspecao.ordemServico.numeroRelatorio"
                  #nome="ngModel"
                  name="numeroRelatorio"
                  id="numeroRelatorio"
                  class="form-control"
                  placeholder="31254525"
                />
              </div>
            </div>
          </form>

          <div class="form-group" *ngFor="let item of notaFiscal.equipamentos">
            <div class="radio">
              <label>
                <input
                  type="radio"
                  [checked] = "inspecao.equipamento.id == item.id"
                  (change)="onItemChange(item)"
                  name="optionsRadios"
                  id="item.id"
                  value="item.id"
                />
                {{ item.descricao }} - {{ item.partNumber }} -
                {{ item.serialNumber }}
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary pull-left"
          data-dismiss="modal"
        >
          Fechar
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="incluirInspecao()"
        >
          Criar inspeção
        </button>
      </div>
    </div>
  </div>
</div>
